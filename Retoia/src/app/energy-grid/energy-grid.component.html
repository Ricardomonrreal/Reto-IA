<div class="game-container">
  <div #renderCanvas class="canvas-container"></div>
  
  <!-- Panel de Control Principal -->
  <div class="ui-panel">
    <div class="title">âš¡ RED DE ENERGÃA LIMPIA</div>
    
    <!-- Presupuesto -->
    <div class="score">
      ğŸ’° PRESUPUESTO: <span style="color: #ffff00;">{{ money | number:'1.0-2' }}</span>
    </div>

    <!-- EstadÃ­sticas de EnergÃ­a -->
    <div class="energy-stats">
      <div class="stat-row">
        <span class="stat-label">âš¡ ProducciÃ³n:</span>
        <span class="stat-value production">{{ totalProduction | number:'1.0-1' }} kW</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸ  Consumo:</span>
        <span class="stat-value consumption">{{ totalConsumption | number:'1.0-0' }} kW</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸ“Š Balance:</span>
        <span class="stat-value" [style.color]="balanceColor">
          {{ energyBalance >= 0 ? '+' : '' }}{{ energyBalance | number:'1.0-1' }} kW
        </span>
      </div>
      <div class="stat-row">
        <span class="stat-label">â™»ï¸ Eficiencia:</span>
        <span class="stat-value efficiency">{{ efficiencyPercent }}%</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸŒ Emisiones:</span>
        <span class="stat-value emissions">{{ totalEmissions | number:'1.0-0' }} kg CO2/h</span>
      </div>
    </div>
    
    <div class="subtitle">FUENTES DE ENERGÃA:</div>
    
    <!-- Botones de Fuentes de EnergÃ­a -->
    <!-- âœ… Usamos el getter energySourcesEntries del TS -->
    <button 
      *ngFor="let source of energySourcesEntries"
      class="building-btn"
      [class.selected]="selectedSource === source.key"
      [disabled]="money < source.value.cost && selectedSource !== source.key"
      (click)="selectSource(source.key)">
      <span>{{ source.value.icon }} {{ source.value.name }}</span>
      <div class="building-info">
        Costo: {{ source.value.cost }}â‚¬ | {{ source.value.production }}kW
      </div>
    </button>
    
    <!-- ğŸ†• SecciÃ³n de Mantenimiento -->
    <div class="subtitle maintenance-section">
      <span style="color: #FFD700;">ğŸ”§ MANTENIMIENTO:</span>
    </div>
    
    <!-- ğŸ†• Botones de tipo de mantenimiento -->
<button 
  *ngFor="let maint of maintenanceTypes | keyvalue"
  class="building-btn maintenance-btn-selector"
  [class.selected]="selectedMaintenanceType === maint.key"
  (click)="selectMaintenanceTypeFromString(maint.key)">
  <span>{{ maint.value.icon }} {{ maint.value.name | uppercase }}</span>
  <div class="building-info">
    Restaura: {{ maint.value.healthRestore }}% | x{{ maint.value.costMultiplier }}
    <span *ngIf="maint.value.bonusEfficiency" style="color: #00AAFF; font-weight: bold;">
      (+{{ maint.value.bonusEfficiency * 100 }}% âš¡ 30s)
    </span>
  </div>
</button>
    
    <!-- BotÃ³n de Cable -->
    <button 
      class="building-btn cable-btn"
      [class.selected]="selectedSource === 'cable'"
      (click)="selectSource('cable')">
      <span>ğŸ”Œ CONECTAR RED</span>
      <div class="building-info">
        Une fuentes de energÃ­a
      </div>
    </button>

    <!-- BotÃ³n Borrador -->
    <button 
      class="building-btn eraser-btn"
      [class.selected]="selectedSource === 'eraser'"
      (click)="selectSource('eraser')">
      <span>ğŸ—‘ï¸ BORRADOR</span>
    </button>
    
    <div class="instructions-bottom">
      <div style="color: #ffff00; margin-bottom: 5px;">ğŸ’¡ OBJETIVO:</div>
      <div>â€¢ Cubrir demanda energÃ©tica</div>
      <div>â€¢ Usar solo renovables (0 CO2)</div>
      <div>â€¢ Conectar red elÃ©ctrica</div>
      <div>â€¢ Mantener fuentes en buen estado</div>
      <div style="margin-top: 8px; border-top: 1px solid #00ff00; padding-top: 8px;">
        <strong>Uso:</strong> Selecciona tipo de mantenimiento â†’ Click en fuente
      </div>
    </div>
  </div>
  
  <!-- ğŸ†• Tabla de Costos de Mantenimiento -->
  <div class="maintenance-cost-table">
    <div class="table-title">ğŸ’° TABLA DE COSTOS DE MANTENIMIENTO</div>
    
    <div class="cost-table">
      <div class="table-header">
        <div class="col-source">FUENTE</div>
        <div class="col-basic">ğŸ”§ BÃSICO</div>
        <div class="col-standard">âš™ï¸ ESTÃNDAR</div>
        <div class="col-premium">âœ¨ PREMIUM</div>
      </div>
      
      <div class="table-row" *ngFor="let source of energySources | keyvalue">
        <div class="col-source">
          <span class="source-icon">{{ source.value.icon }}</span>
          <span>{{ source.value.name }}</span>
        </div>
        <div class="col-basic">
  {{ getMaintenanceCost(source.key, 'basic') }}â‚¬
  <div class="restore-info">+50% (2s)</div>
</div>
<div class="col-standard">
  {{ getMaintenanceCost(source.key, 'standard') }}â‚¬
  <div class="restore-info">+100% (3s)</div>
</div>
<div class="col-premium">
  {{ getMaintenanceCost(source.key, 'premium') }}â‚¬
  <div class="restore-info bonus">+100% +10%âš¡ (4s)</div>
</div>
      </div>
    </div>
    
    <div class="table-legend">
      <div><strong>ğŸ”§ BÃ¡sico:</strong> RÃ¡pido y barato (50% salud)</div>
      <div><strong>âš™ï¸ EstÃ¡ndar:</strong> RestauraciÃ³n completa (100%)</div>
      <div><strong>âœ¨ Premium:</strong> Completo + bonus eficiencia 30s</div>
      <div style="margin-top: 8px; color: #ffaa00;">
        ğŸ’¡ ProducciÃ³n = 0 durante mantenimiento
      </div>
    </div>
  </div>
  
  <!-- Panel de Salud de Fuentes (ACTUALIZADO) -->
  <div class="health-panel" *ngIf="placedSources.length > 0">
    <div class="panel-title">ğŸ”§ ESTADO DE FUENTES</div>
    
    <!-- ğŸ†• Indicadores de estado especial -->
    <div class="special-status" *ngIf="sourcesInMaintenance > 0 || sourcesWithBonus > 0">
      <div *ngIf="sourcesInMaintenance > 0" class="status-badge maintenance">
        â³ {{ sourcesInMaintenance }} en mantenimiento
      </div>
      <div *ngIf="sourcesWithBonus > 0" class="status-badge bonus">
        âš¡ {{ sourcesWithBonus }} con bonus activo
      </div>
    </div>
    
    <div class="health-list">
      <div *ngFor="let source of placedSources" 
           class="health-item"
           [class.critical]="source.health < 30 && !source.isUnderMaintenance"
           [class.warning]="source.health >= 30 && source.health < 60 && !source.isUnderMaintenance"
           [class.healthy]="source.health >= 60 && !source.isUnderMaintenance"
           [class.maintenance]="source.isUnderMaintenance"
           [class.bonus]="source.bonusEfficiency && !source.isUnderMaintenance">
        
        <div class="health-info">
          <div class="health-header">
            <span class="source-icon">{{ energySourcesUI[source.type].icon }}</span>
            <span class="source-location">({{ source.x }},{{ source.z }})</span>
            
            <!-- ğŸ†• Indicadores especiales -->
            <span *ngIf="source.isUnderMaintenance" class="status-indicator maintenance-indicator">
              â³
            </span>
            <span *ngIf="source.bonusEfficiency && !source.isUnderMaintenance" 
                  class="status-indicator bonus-indicator">
              âš¡+{{ (source.bonusEfficiency * 100) | number:'1.0-0' }}%
            </span>
            
            <span class="health-percent">{{ source.health | number:'1.0-0' }}%</span>
          </div>
          
          <div class="health-bar-container">
            <div class="health-bar" 
                 [style.width.%]="source.health"
                 [style.background]="
                   source.health < 30 ? '#ff0000' :
                   source.health < 60 ? '#ffaa00' : '#00ff00'">
            </div>
          </div>
          
          <div class="efficiency-text">
            <span>âš¡ Eficiencia: </span>
            <span [style.color]="source.isUnderMaintenance ? '#FFFF00' : 
                                 source.bonusEfficiency ? '#00AAFF' : '#ffffff'">
              {{ source.isUnderMaintenance ? 0 : 
                 (source.efficiency * (source.bonusEfficiency ? 1 + source.bonusEfficiency : 1)) * 100 | number:'1.0-0' }}%
            </span>
            <span *ngIf="source.isUnderMaintenance" style="color: #FFFF00; margin-left: 5px;">
              (En proceso)
            </span>
          </div>
        </div>
        <button class="maintenance-btn"
                [disabled]="money < (energySourcesUI[source.type].maintenanceCost || 0) || source.health >= 95"
                (click)="performMaintenance(source.x, source.z)"
                [title]="source.health >= 95 ? 'No necesita mantenimiento' : 'Reparar al 100%'">
          ğŸ”§ {{ energySourcesUI[source.type].maintenanceCost || 0 }}â‚¬
        </button>
      </div>
    </div>
    
    <div class="health-summary">
      <div class="summary-item">
        <span>ğŸŸ¢ Buenas:</span>
        <span>{{ healthySources }}</span>
      </div>
      <div class="summary-item">
        <span>ğŸŸ¡ Advertencia:</span>
        <span>{{ warningSources }}</span>
      </div>
      <div class="summary-item critical-count">
        <span>ğŸ”´ CrÃ­ticas:</span>
        <span>{{ criticalSources }}</span>
      </div>
    </div>
  </div>
  
  <!-- Panel de Instrucciones (ACTUALIZADO) -->
  <div class="instructions-panel">
    <div class="instructions-title">ğŸ® CONTROLES</div>
    <div>â€¢ <span style="color: #ffff00;">Click</span>: Colocar fuente</div>
    <div>â€¢ <span style="color: #ffff00;">Mantenimiento</span>: Selecciona tipo + Click</div>
    <div>â€¢ <span style="color: #ffff00;">Modo Cable</span>: Click en 2 fuentes</div>
    <div>â€¢ <span style="color: #ffff00;">Mouse Wheel</span>: Zoom</div>
    <div>â€¢ <span style="color: #ffff00;">Click Medio/Der</span>: Mover cÃ¡mara</div>
    <div>â€¢ <span style="color: #ffff00;">WASD</span>: Mover cÃ¡mara</div>
    
    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #00ff00;">
      <div style="color: #ffff00; font-weight: bold; margin-bottom: 5px;">ğŸ“‹ GUÃA RÃPIDA:</div>
      <div style="font-size: 11px;">
        <div><strong>â˜€ï¸ Solar:</strong> Bajo costo, baja producciÃ³n</div>
        <div><strong>ğŸ’¨ EÃ³lica:</strong> Medio costo, buena producciÃ³n</div>
        <div><strong>ğŸ’§ Hidro:</strong> Alto costo, mÃ¡xima producciÃ³n</div>
        <div><strong>ğŸ”‹ BaterÃ­a:</strong> Almacena energÃ­a</div>
        <div><strong>â˜¢ï¸ Nuclear:</strong> Alto costo, producciÃ³n constante</div>
      </div>
    </div>
    
    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #ff6666;">
      <div style="color: #ff6666; font-weight: bold; margin-bottom: 5px;">âš ï¸ MECÃNICAS:</div>
      <div style="font-size: 11px;">
        <div><strong>ğŸ”§ DegradaciÃ³n:</strong> Las fuentes pierden salud</div>
        <div><strong>âš¡ PÃ©rdida:</strong> Cables largos = menos energÃ­a</div>
        <div><strong>ğŸŸ¢ Verde:</strong> Salud buena (60-100%)</div>
        <div><strong>ğŸŸ¡ Amarillo:</strong> Necesita mantenciÃ³n (30-60%)</div>
        <div><strong>ğŸ”´ Rojo:</strong> CrÃ­tico + humo (&lt;30%)</div>
        <div><strong>ğŸŸ¡ Parpadeante:</strong> En mantenimiento</div>
        <div><strong>ğŸ”µ Azul:</strong> Con bonus activo</div>
        <div style="margin-top: 6px; color: #ffaa00;">
          ğŸ’¡ Cables cortos = mayor eficiencia
        </div>
      </div>
    </div>
  </div>
  
  <!-- Indicador de acciÃ³n actual -->
  <div class="action-indicator" 
       [class.eraser-mode]="selectedSource === 'eraser'"
       [class.cable-mode]="selectedSource === 'cable'"
       [class.maintenance-mode]="selectedSource === 'maintenance'">
    <span *ngIf="selectedSource === 'eraser'">ğŸ—‘ï¸ MODO BORRADOR</span>
    <span *ngIf="selectedSource === 'cable'">ğŸ”Œ MODO CONEXIÃ“N - Click en 2 fuentes</span>
    <span *ngIf="selectedSource === 'maintenance' && selectedMaintenanceType">
      {{ maintenanceTypes[selectedMaintenanceType].icon }} 
      MANTENIMIENTO {{ maintenanceTypes[selectedMaintenanceType].name | uppercase }} 
      - Click en fuente para aplicar
    </span>
    <span *ngIf="selectedSource !== 'eraser' && selectedSource !== 'cable' && selectedSource !== 'maintenance'">
      âš¡COLOCANDO: {{ energySourcesUI[selectedSource].name || 'NADA' }}
    </span>
  </div>

  <!-- Panel de Estado -->
  <div class="alert-panel" 
       [class.alert-success]="energyBalance >= 0"
       [class.alert-danger]="energyBalance < 0">
    <div *ngIf="energyBalance >= 0" class="alert-content">
      <span class="alert-icon">âœ…</span>
      <div>
        <strong>RED ESTABLE</strong>
        <div class="alert-sub">ProducciÃ³n supera consumo</div>
      </div>
    </div>
    <div *ngIf="energyBalance < 0" class="alert-content">
      <span class="alert-icon">âš ï¸</span>
      <div>
        <strong>DÃ‰FICIT ENERGÃ‰TICO</strong>
        <div class="alert-sub">Necesitas mÃ¡s fuentes de energÃ­a</div>
      </div>
    </div>
  </div>

  <!-- BotÃ³n Volver -->
  <div class="boton-volver-container">
    <button class="boton-volver" (click)="goToMenu()">
      â¬… Volver a Niveles
    </button>
  </div>
</div>
