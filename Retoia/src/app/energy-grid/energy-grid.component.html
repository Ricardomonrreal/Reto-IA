<div class="game-container">
  <div #renderCanvas class="canvas-container"></div>
  
  <!-- Panel de Control Principal -->
  <div class="ui-panel">
    <div class="title">âš¡ RED DE ENERGÃA LIMPIA</div>
    
    <!-- Presupuesto -->
    <div class="score">
      ğŸ’° PRESUPUESTO: <span style="color: #ffff00;">{{ money | number:'1.0-2' }}</span>
    </div>

    <!-- EstadÃ­sticas de EnergÃ­a -->
    <div class="energy-stats">
      <div class="stat-row">
        <span class="stat-label">âš¡ ProducciÃ³n:</span>
        <span class="stat-value production">{{ totalProduction | number:'1.0-1' }} kW</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸ  Consumo:</span>
        <span class="stat-value consumption">{{ totalConsumption | number:'1.0-0' }} kW</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸ“Š Balance:</span>
        <span class="stat-value" [style.color]="balanceColor">
          {{ energyBalance >= 0 ? '+' : '' }}{{ energyBalance | number:'1.0-1' }} kW
        </span>
      </div>
      <div class="stat-row">
        <span class="stat-label">â™»ï¸ Eficiencia:</span>
        <span class="stat-value efficiency">{{ efficiencyPercent }}%</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ğŸŒ Emisiones:</span>
        <span class="stat-value emissions">{{ totalEmissions | number:'1.0-0' }} kg CO2/h</span>
      </div>
    </div>
    
    <div class="subtitle">FUENTES DE ENERGÃA:</div>
    
    <!-- Botones de Fuentes de EnergÃ­a -->
    <!-- âœ… Usamos el getter energySourcesEntries del TS -->
    <button 
      *ngFor="let source of energySourcesEntries"
      class="building-btn"
      [class.selected]="selectedSource === source.key"
      [disabled]="money < source.value.cost && selectedSource !== source.key"
      (click)="selectSource(source.key)">
      <span>{{ source.value.icon }} {{ source.value.name }}</span>
      <div class="building-info">
        Costo: {{ source.value.cost }}â‚¬ | {{ source.value.production }}kW
      </div>
    </button>
    
    <!-- BotÃ³n de Cable -->
    <button 
      class="building-btn cable-btn"
      [class.selected]="selectedSource === 'cable'"
      (click)="selectSource('cable')">
      <span>ğŸ”Œ CONECTAR RED</span>
      <div class="building-info">
        Une fuentes de energÃ­a
      </div>
    </button>

    <!-- BotÃ³n Borrador -->
    <button 
      class="building-btn eraser-btn"
      [class.selected]="selectedSource === 'eraser'"
      (click)="selectSource('eraser')">
      <span>ğŸ—‘ï¸ BORRADOR</span>
    </button>
    
    <div class="instructions-bottom">
      <div style="color: #ffff00; margin-bottom: 5px;">ğŸ’¡ OBJETIVO:</div>
      <div>â€¢ Cubrir demanda energÃ©tica</div>
      <div>â€¢ Usar solo renovables (0 CO2)</div>
      <div>â€¢ Conectar red elÃ©ctrica</div>
      <div>â€¢ ğŸ†• Mantener fuentes en buen estado</div>
      <div style="margin-top: 8px; border-top: 1px solid #00ff00; padding-top: 8px;">
        <strong>SHIFT + Click:</strong> Mantenimiento
      </div>
    </div>
  </div>
  
  <!-- ğŸ†• Panel de Salud de Fuentes -->
  <div class="health-panel" *ngIf="placedSources.length > 0">
    <div class="panel-title">ğŸ”§ ESTADO DE FUENTES</div>
    <div class="health-list">
      <div *ngFor="let source of placedSources" 
           class="health-item"
           [class.critical]="source.health < 30"
           [class.warning]="source.health >= 30 && source.health < 60"
           [class.healthy]="source.health >= 60">
        <div class="health-info">
          <div class="health-header">
            <span class="source-icon">{{ energySourcesUI[source.type].icon }}</span>
            <span class="source-location">({{ source.x }},{{ source.z }})</span>
            <span class="health-percent">{{ source.health | number:'1.0-0' }}%</span>
          </div>
          <div class="health-bar-container">
            <div class="health-bar" 
                 [style.width.%]="source.health"
                 [style.background]="
                   source.health < 30 ? '#ff0000' :
                   source.health < 60 ? '#ffaa00' : '#00ff00'">
            </div>
          </div>
          <div class="efficiency-text">
            âš¡ Eficiencia: {{ (source.efficiency * 100) | number:'1.0-0' }}%
          </div>
        </div>
        <button class="maintenance-btn"
                [disabled]="money < (energySourcesUI[source.type].maintenanceCost || 0) || source.health >= 95"
                (click)="performMaintenance(source.x, source.z)"
                [title]="source.health >= 95 ? 'No necesita mantenimiento' : 'Reparar al 100%'">
          ğŸ”§ {{ energySourcesUI[source.type].maintenanceCost || 0 }}â‚¬
        </button>
      </div>
    </div>
    
    <div class="health-summary">
      <div class="summary-item">
        <span>ğŸŸ¢ Buenas:</span>
        <span>{{ healthySources }}</span>
      </div>
      <div class="summary-item">
        <span>ğŸŸ¡ Advertencia:</span>
        <span>{{ warningSources }}</span>
      </div>
      <div class="summary-item critical-count">
        <span>ğŸ”´ CrÃ­ticas:</span>
        <span>{{ criticalSources }}</span>
      </div>
    </div>
  </div>
  
  <!-- Panel de Instrucciones -->
  <div class="instructions-panel">
    <div class="instructions-title">ğŸ® CONTROLES</div>
    <div>â€¢ <span style="color: #ffff00;">Click</span>: Colocar fuente</div>
    <div>â€¢ <span style="color: #ffff00;">SHIFT + Click</span>: Mantenimiento ğŸ†•</div>
    <div>â€¢ <span style="color: #ffff00;">Modo Cable</span>: Click en 2 fuentes</div>
    <div>â€¢ <span style="color: #ffff00;">Mouse Wheel</span>: Zoom</div>
    <div>â€¢ <span style="color: #ffff00;">Click Medio/Der</span>: Mover cÃ¡mara</div>
    
    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #00ff00;">
      <div style="color: #ffff00; font-weight: bold; margin-bottom: 5px;">ğŸ“‹ GUÃA RÃPIDA:</div>
      <div style="font-size: 11px;">
        <div><strong>â˜€ï¸ Solar:</strong> Bajo costo, baja producciÃ³n</div>
        <div><strong>ğŸ’¨ EÃ³lica:</strong> Medio costo, buena producciÃ³n</div>
        <div><strong>ğŸ’§ Hidro:</strong> Alto costo, mÃ¡xima producciÃ³n</div>
        <div><strong>ğŸ”‹ BaterÃ­a:</strong> Almacena energÃ­a</div>
        <div><strong>â˜¢ï¸ Nuclear:</strong> Alto costo, producciÃ³n constante</div>
      </div>
    </div>
    
    <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid #ff6666;">
      <div style="color: #ff6666; font-weight: bold; margin-bottom: 5px;">âš ï¸MECÃNICAS:</div>
      <div style="font-size: 11px;">
        <div><strong>ğŸ”§ DegradaciÃ³n:</strong> Las fuentes pierden salud</div>
        <div><strong>âš¡ PÃ©rdida:</strong> Cables largos = menos energÃ­a</div>
        <div><strong>ğŸŸ¢ Verde:</strong> Salud buena (60-100%)</div>
        <div><strong>ğŸŸ¡ Amarillo:</strong> Necesita mantenciÃ³n (30-60%)</div>
        <div><strong>ğŸ”´ Rojo:</strong> CrÃ­tico + humo (<30%)</div>
        <div style="margin-top: 6px; color: #ffaa00;">
          ğŸ’¡ Cables cortos = mayor eficiencia
        </div>
      </div>
    </div>
  </div>
  
  <!-- Indicador de acciÃ³n actual -->
  <div class="action-indicator" 
       [class.eraser-mode]="selectedSource === 'eraser'"
       [class.cable-mode]="selectedSource === 'cable'">
    <span *ngIf="selectedSource === 'eraser'">ğŸ—‘ï¸ MODO BORRADOR</span>
    <span *ngIf="selectedSource === 'cable'">ğŸ”Œ MODO CONEXIÃ“N - Click en 2 fuentes</span>
    <span *ngIf="selectedSource !== 'eraser' && selectedSource !== 'cable'">
      âš¡ COLOCANDO: {{ energySourcesUI[selectedSource].name || 'NADA' }}
    </span>
  </div>

  <!-- Panel de Estado -->
  <div class="alert-panel" 
       [class.alert-success]="energyBalance >= 0"
       [class.alert-danger]="energyBalance < 0">
    <div *ngIf="energyBalance >= 0" class="alert-content">
      <span class="alert-icon">âœ…</span>
      <div>
        <strong>RED ESTABLE</strong>
        <div class="alert-sub">ProducciÃ³n supera consumo</div>
      </div>
    </div>
    <div *ngIf="energyBalance < 0" class="alert-content">
      <span class="alert-icon">âš ï¸</span>
      <div>
        <strong>DÃ‰FICIT ENERGÃ‰TICO</strong>
        <div class="alert-sub">Necesitas mÃ¡s fuentes de energÃ­a</div>
      </div>
    </div>
  </div>

  <!-- BotÃ³n Volver -->
  <div class="boton-volver-container">
    <button class="boton-volver" (click)="goToMenu()">
      â¬… Volver a Niveles
    </button>
  </div>
</div>
